{
    "dataset_reader": {
        "class_name": "multitask_reader",
        "data_path": "null",
        "tasks": {
            "mrpc": {
                "reader_class_name": "basic_classification_reader",
                "x": [
                    "#1 String",
                    "#2 String"
                ],
                "y": "Quality",
                "data_path": "{GLUE_CSV}/MRPC"
            },
            "rte": {
                "reader_class_name": "basic_classification_reader",
                "x": [
                    "sentence1",
                    "sentence2"
                ],
                "y": "label",
                "data_path": "{GLUE_CSV}/RTE"
            }
        }
    },
    "dataset_iterator": {
        "class_name": "multitask_pal_bert_iterator",
        "num_train_epochs": "{NUM_TRAIN_EPOCHS}",
        "steps_per_epoch": "{STEPS_PER_EPOCH}",
        "gradient_accumulation_steps": "{GRADIENT_ACC_STEPS}",
        "tasks": {
            "mrpc": {
                "iterator_class_name": "basic_classification_iterator",
                "seed": 12
            },
            "rte": {
                "iterator_class_name": "basic_classification_iterator",
                "seed": 12
            }
        }
    },
    "chainer": {
        "in": [
            "x_mrpc_with_id",
            "x_rte_with_id"
        ],
        "in_y": [
            "y_mrpc",
            "y_rte"
        ],
        "pipe": [
            {
                "class_name": "multitask_pal_bert_preprocessor",
                "in": [
                    "x_mrpc_with_id",
                    "x_rte_with_id"
                ],
                "out": [
                    "task_id",
                    "x_mrpc",
                    "x_rte"
                ]
            },
            {
                "class_name": "input_splitter",
                "keys_to_extract": [
                    0,
                    1
                ],
                "in": [
                    "x_mrpc"
                ],
                "out": [
                    "x_mrpc1",
                    "x_mrpc2"
                ]
            },
            {
                "class_name": "input_splitter",
                "keys_to_extract": [
                    0,
                    1
                ],
                "in": [
                    "x_rte"
                ],
                "out": [
                    "x_rte1",
                    "x_rte2"
                ]
            },
            {
                "class_name": "torch_transformers_preprocessor",
                "vocab_file": "bert-base-uncased",
                "max_seq_length": 128,
                "in": [
                    "x_mrpc1",
                    "x_mrpc2"
                ],
                "out": [
                    "bert_features_mrpc"
                ]
            },
            {
                "class_name": "torch_transformers_preprocessor",
                "vocab_file": "bert-base-uncased",
                "max_seq_length": 128,
                "in": [
                    "x_rte1",
                    "x_rte2"
                ],
                "out": [
                    "bert_features_rte"
                ]
            },
            {
                "id": "vocab_mrpc",
                "class_name": "simple_vocab",
                "fit_on": [
                    "y_mrpc"
                ],
                "save_path": "{MODELS_PATH}/mrpc.dict",
                "load_path": "{MODELS_PATH}/mrpc.dict",
                "in": [
                    "y_mrpc"
                ],
                "out": [
                    "y_ids_mrpc"
                ]
            },
            {
                "id": "vocab_rte",
                "class_name": "simple_vocab",
                "fit_on": [
                    "y_rte"
                ],
                "save_path": "{MODELS_PATH}/rte.dict",
                "load_path": "{MODELS_PATH}/rte.dict",
                "in": [
                    "y_rte"
                ],
                "out": [
                    "y_ids_rte"
                ]
            },
            {
                "id": "multitask_pal_bert",
                "class_name": "multitask_pal_bert",
                "pretrained_bert": "{PRETRAINED_BERT}/pytorch_model.bin",
                "optimizer_parameters": {"lr": 4e-5},
                "gradient_accumulation_steps": "{GRADIENT_ACC_STEPS}",
                "steps_per_epoch": "{STEPS_PER_EPOCH}",
                "learning_rate_drop_patience": 2,
                "learning_rate_drop_div": 2.0,
                "return_probas": true,
                "save_path": "{MODELS_PATH}/model",
                "load_path": "{MODELS_PATH}/model",
                "tasks": {
                    "mrpc": {
                        "n_classes": "#vocab_mrpc.len"
                    },
                    "rte": {
                        "n_classes": "#vocab_rte.len"
                    }
                },
                "in_distribution": {
                    "mrpc": 1,
                    "rte": 1
                },
                "in": [
                    "task_id",
                    "bert_features_mrpc",
                    "bert_features_rte"
                ],
                "in_y_distribution": {
                    "mrpc": 1,
                    "rte": 1
                },
                "in_y": [
                    "y_ids_mrpc",
                    "y_ids_rte"
                ],
                "out": [
                    "y_mrpc_pred_probas",
                    "y_rte_pred_probas"
                ]
            },
            {
                "in": [
                    "y_mrpc_pred_probas"
                ],
                "out": [
                    "y_mrpc_pred_ids"
                ],
                "class_name": "proba2labels",
                "max_proba": true
            },
            {
                "in": [
                    "y_mrpc_pred_ids"
                ],
                "out": [
                    "y_mrpc_pred_labels"
                ],
                "ref": "vocab_mrpc"
            },
            {
                "in": [
                    "y_rte_pred_probas"
                ],
                "out": [
                    "y_rte_pred_ids"
                ],
                "class_name": "proba2labels",
                "max_proba": true
            },
            {
                "in": [
                    "y_rte_pred_ids"
                ],
                "out": [
                    "y_rte_pred_labels"
                ],
                "ref": "vocab_rte"
            }
        ],
        "out": [
            "y_mrpc_pred_labels",
            "y_rte_pred_labels"
        ]
    },
    "train": {
        "epochs": "{NUM_TRAIN_EPOCHS}",
        "batch_size": 16,
        "metrics": [
            {
                "name": "multitask_accuracy",
                "inputs": [
                    "y_ids_rte",
                    "y_ids_mrpc",
                    "y_rte_pred_ids",
                    "y_mrpc_pred_ids"
                ]
            },
            {
                "name": "accuracy",
                "inputs": [
                    "y_ids_mrpc",
                    "y_mrpc_pred_ids"
                ]
            },
            {
                "name": "f1",
                "inputs": [
                    "y_ids_rte",
                    "y_rte_pred_ids"
                ]
            }
        ],
        "validation_patience": 5,
        "val_every_n_epochs": 1,
        "log_every_n_epochs": 1,
        "show_examples": false,
        "evaluation_targets": [
            "valid"
        ],
        "class_name": "torch_trainer"
    },
    "metadata": {
        "variables": {
            "ROOT_PATH": "/content",
            "DOWNLOADS_PATH": "{ROOT_PATH}/downloads",
            "PRETRAINED_BERT": "{ROOT_PATH}/pretrained_bert",
            "MODELS_PATH": "{ROOT_PATH}/models",
            "GLUE_CSV": "{ROOT_PATH}/glue_csv",
            "NUM_TRAIN_EPOCHS": 10,
            "STEPS_PER_EPOCH": 210,
            "GRADIENT_ACC_STEPS": 2
        },
        "download": [
            {
                "url": "https://huggingface.co/bert-base-uncased/resolve/main/pytorch_model.bin",
                "subdir": "{PRETRAINED_BERT}"
            }
        ]
    }
}